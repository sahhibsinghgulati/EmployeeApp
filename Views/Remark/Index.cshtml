@model IEnumerable<EmployeeApp.Models.vw_EmployeeRemark>

@{
    ViewBag.Title = "Manage Remarks";
    var currentId = ViewBag.CurrentEmpId;
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-primary">
                <div class="panel-heading text-center mb-2" style="font-weight: bold;">Submit Employee Remark</div>
                <div class="panel-body">

                    @if (TempData["Message"] != null)
                    {<div class="alert alert-success">@TempData["Message"]</div>}
                    @if (TempData["Error"] != null)
                    {<div class="alert alert-danger">@TempData["Error"]</div>}

                    @using (Html.BeginForm("Upload", "Remark", FormMethod.Post, new { enctype = "multipart/form-data" }))
                    {
                        <div class="form-group mb-3">
                            <label>Select Employee (Filter & Upload)</label>

                            @Html.DropDownList("EmpId", (SelectList)ViewBag.EmpList, "-- All Employees --", new
                            {
                                @class = "form-control",
                                required = "required",
                                onchange = "window.location.href='" + Url.Action("Index", "Remark") + "?id=' + this.value"
                            })
                        </div>

                        <div class="form-group mb-3">
                            <label>Remark Type</label>
                            <div class="pt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input"
                                           type="radio"
                                           name="Type"
                                           id="typePositive"
                                           value="Positive"
                                           required />
                                    <label class="form-check-label" for="typePositive">
                                        Positive
                                    </label>
                                </div>

                                <div class="form-check form-check-inline">
                                    <input class="form-check-input"
                                           type="radio"
                                           name="Type"
                                           id="typeNegative"
                                           value="Negative" />
                                    <label class="form-check-label" for="typeNegative">
                                        Negative
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-3">
                            <label>Remark</label>
                            <textarea name="Remark" class="form-control" rows="3" placeholder="Enter Remark"></textarea>
                        </div>

                        <div class="form-group mb-3">
                            <label>Upload Supporting Documents</label>
                            <input type="file" name="fileUpload" class="form-control"/>
                        </div>

                        <button type="submit" class="btn btn-success">Upload Document</button>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="panel panel-default">
                <div class="panel-heading text-center mb-2" style="font-weight: bold;">
                    Submitted Remarks
                    @if (currentId != null)
                    {
                        <span class="label label-info pull-right">Filtered View</span>
                    }
                </div>
                <div class="panel-body">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th style="white-space: nowrap;">Employee</th>
                                <th style="white-space: nowrap;">Sign</th>
                                <th style="white-space: nowrap;">Remark</th>
                                <th style="white-space: nowrap;">Created On</th>
                                <th style="width: 150px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.Any())
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@item.EmployeeName</td>
                                        <td>@item.Type</td>
                                        <td>@item.Remark</td>
                                        <td>@item.CreatedOn.Value.ToString("dd-MMM-yyyy")</td>
                                        <td>
                                            @if (item.FilePath != null)
                                            {
                                                <a href="@Url.Action("Download", "Document", new { filePath = item.FilePath })" class="btn btn-primary" title="Download">
                                                    <i class="bi bi-download"></i>
                                                </a>
                                            }
                                            else
                                            {
                                                <a class="btn btn-outline-secondary" title="Download">
                                                    <i class="bi bi-download" style="color:red"></i>
                                                </a>
                                            }
                                            <a href="@Url.Action("Delete", "Remark", new { id = item.RemID })"
                                               class="btn btn-danger"
                                               onclick="return confirm('Are you sure you want to permanently delete this Remark?');"
                                               title="Delete Remark">
                                                <i class="bi bi-trash3-fill"></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="5" class="text-center text-muted">
                                        @(currentId == null ? "No Remarks found." : "No Remarks found for this employee.")
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>$(document).ready(function () {
            // Check if the alert exists
            var alertBox = $(".alert");
            if (alertBox.length > 0) {
                // Wait 10 seconds (10000ms), then fade it out
                setTimeout(function () {
                    alertBox.fadeOut("slow");
                }, 5000);
            }
        });</script>
}
